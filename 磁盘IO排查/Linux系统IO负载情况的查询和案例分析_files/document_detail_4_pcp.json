window.documentDetailJSON={"code":200,"data":{"authorName":"wb-cl443532","content":"<blockquote>\n<p data-spm-anchor-id=\"a2c9r.12641768.0.i25.39875480HS1ImI\"><strong>免责声明：&nbsp;</strong>本文档可能包含第三方产品信息，该信息仅供参考。阿里云对第三方产品的性能、可靠性以及操作可能带来的潜在影响，不做任何暗示或其他形式的承诺。</p>\n</blockquote>\n<p data-spm-anchor-id=\"a2c9r.12641768.0.i24.39875480HS1ImI\">&nbsp;</p>\n<h2 id=\"noPMw\" data-spm-anchor-id=\"a2c9r.12641768.0.i24.39875480HS1ImI\">概述</h2>\n<p data-spm-anchor-id=\"a2c9r.12641768.0.i26.39875480HS1ImI\">本文主要对Linux系统IO负载情况的查询和案例分析进行说明。</p>\n<p data-spm-anchor-id=\"a2c9r.12641768.0.i26.39875480HS1ImI\">&nbsp;</p>\n<h2 id=\"n49mj\">详细信息</h2>\n<blockquote>\n<p data-spm-anchor-id=\"a2c9r.12641779.0.i0.1badSS8aSS8aLc\">阿里云提醒您：</p>\n<ul>\n<li data-spm-anchor-id=\"a2c9r.12641768.0.i10.57bb5e3bmxozwF\">如果您对实例或数据有修改、变更等风险操作，务必注意实例的容灾、容错能力，确保数据安全。</li>\n<li data-spm-anchor-id=\"a2c9r.12641779.0.i0.b170EQFdEQFdJ5\">如果您对实例（包括但不限于ECS、RDS）等进行配置与数据修改，建议提前创建快照或开启RDS日志备份等功能。</li>\n<li data-spm-anchor-id=\"a2c9r.12641779.0.i2.1badSS8aSS8aLc\">如果您在阿里云平台授权或者提交过登录账号、密码等安全信息，建议您及时修改。</li>\n</ul>\n</blockquote>\n<p data-spm-anchor-id=\"a2c9r.12641768.0.i28.39875480lzrBFV\">&nbsp;</p>\n<h3 id=\"TPZHX\" data-spm-anchor-id=\"a2c9r.12641768.0.i28.39875480lzrBFV\">IO负载的查询与分析</h3>\n<h4 id=\"THCej\">使用iostat从系统纬度查看磁盘IO负载</h4>\n<p>iostat并非常见Linux发行版本自带工具，其包含在sysstat软件包中，需要先通过yum或apt-get等方式进行安装后才能使用。具体安装方法本文不再详述。</p>\n<p>&nbsp;</p>\n<h5 id=\"JafGy\">用法说明</h5>\n<p>执行如下命令，查看磁盘IO负载。</p>\n<pre>iostat -d -k 2</pre>\n<blockquote>\n<p>注：</p>\n<ul>\n<li>-d：显示设备（磁盘）使用状态。</li>\n<li>-k：表示让某些使用block为单位的列强制使用kB为单位。</li>\n<li>2：数据显示每隔2秒刷新一次。</li>\n</ul>\n</blockquote>\n<p>系统显示类似如下。</p>\n<pre>Linux 3.10.0-123.9.3.el7.x8664 (centos)     06/27/2016     _x86_64    (1 CPU)<br>Device:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn<br>xvda              0.58         0.12         3.75     278001    8820028<br>xvdb              0.00         0.00         0.00        740          0<br>xvdc              0.00         0.00         0.00       1388          0<br>xvde              0.00         0.00         0.00       2035          0<br>xvdf              0.00         0.00         0.00        740          0</pre>\n<blockquote>\n<p><strong>提示</strong>：更多参数及返回结果说明，可以参阅iostat的man帮助。</p>\n</blockquote>\n<p>&nbsp;</p>\n<h4 id=\"njTGp\">使用iotop从进程纬度查看磁盘IO负载</h4>\n<p>iotop也并非常见Linux发行版本自带工具，也需要先通过yum或apt-get等方式进行安装后才能使用。具体安装方法本文不再详述。</p>\n<blockquote>\n<p><strong>提示</strong>：可以通过iotop从进程维度对系统内进程的IO使用情况进行排序。</p>\n</blockquote>\n<p>&nbsp;</p>\n<h5 id=\"cyeSW\">用法说明</h5>\n<p>执行iotop命令，可以看到类似以下界面。</p>\n<p><img src=\"https://img.alicdn.com/tfscom/TB1ppKJKFXXXXXgaFXXXXXXXXXX.png\"></p>\n<p>&nbsp;</p>\n<h5 id=\"iBRWK\">系统显示说明</h5>\n<ul>\n<li>默认情况下按照IO使用量倒序排序，可以用左右箭头操作排序的字段。</li>\n<li>按r切换排序方式。</li>\n<li>按o只显示有磁盘IO活动的进程。</li>\n<li>更多参数及返回结果说明，可以参阅iotop的man帮助。</li>\n</ul>\n<p>&nbsp;</p>\n<h3 id=\"ixEwX\">IO负载相关操作案例</h3>\n<h4 id=\"xJXHf\">kjournald进程占用IO资源高问题</h4>\n<h5 id=\"Srsmf\">问题描述</h5>\n<p>使用iotop排查分析，发现kjournald进程占用了大量IO资源。</p>\n<p>&nbsp;</p>\n<h5 id=\"aQyPH\">问题原因</h5>\n<p>kjournald进程是ext3文件系统进行IO数据操作的内核进程，它会在向磁盘内写入和读取数据时占用CPU和内存资源。该问题通常是由于ext3文件系统循环的写数据，Journal size不断增大，进而占满导致。</p>\n<p>&nbsp;</p>\n<h5 id=\"aQyPH\">处理办法</h5>\n<p>执行如下命令，通过dumpe2fs指令查看相应分区的Journal size配置情况，然后尝试调大该值，看问题是否缓解。</p>\n<pre>dumpe2fs /dev/xvda1 | grep Journal</pre>\n<p>系统显示类似如下。</p>\n<pre>dumpe2fs 1.42.9 (28-Dec-2013)<br>Journal inode: 8<br>Journal backup: inode blocks<br>Journal features: journal_incompat_revoke<br>Journal size: 128M<br>Journal length: 32768<br>Journal sequence: 0x00010ffb<br>Journal start: 10953</pre>\n<p>&nbsp;</p>\n<h4 id=\"bzzbX\">通过4K对齐提高IO性能</h4>\n<p>本节主要介绍如何通过如下脚本对磁盘进行格式化并自动配置4K对齐。</p>\n<blockquote>\n<p><strong>提示</strong>：运行此脚本会自动格式化所有数据盘磁盘。如果并非新购磁盘，请在操作前，务必确认已经完成相关磁盘上的数据备份。可以通过快照进行磁盘的备份，操作方法可以参见<a class=\"from-extensions-error\" href=\"/document_detail/25455.htm\">创建快照</a>。</p>\n</blockquote>\n<ol>\n<li>将如下压缩包解压，将解压后脚本并上传到目标服务器。<br><a class=\"from-extensions-error\" href=\"https://onekb.oss-cn-zhangjiakou.aliyuncs.com/50443667/fa6a03ae-3424-4485-ac82-a7d2b166b249.zip\">auto_fdisk.zip</a></li>\n<li>进入脚本所在目录，使用root用户，依次执行如下命令，给脚本添加执行权限，然后运行脚本即可。\n<pre>chmod +x ./auto_fdisk.sh<br>./auto_fdisk.sh</pre>\n</li>\n</ol>\n<p data-spm-anchor-id=\"a2c9r.12641768.0.i26.39875480HS1ImI\">&nbsp;</p>\n<h2 id=\"irJ54\">适用于</h2>\n<ul>\n<li data-spm-anchor-id=\"a2c9r.12641768.0.i30.39875480lzrBFV\">云服务器 ECS</li>\n</ul>","language":"zh","lastModifiedTime":1577780989000,"level":8,"nodeId":41224,"nodeType":2,"showType":1,"taskStatus":"NO_TASK_AVAILABLE","title":"Linux系统IO负载情况的查询和案例分析","userVO":{},"website":"cn"},"success":true}